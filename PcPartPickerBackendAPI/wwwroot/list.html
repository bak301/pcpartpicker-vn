<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/main.css">

    <title>System Build - </title>
</head>

<body>
    <header>
        <div class="container">
            <div class="pcpp-header">
                <a href="/">
                    <h1>PCPartPicker</h1>
                </a>
                <ul class="user-nav">

                    <li><a href="/accounts/login">Log In</a></li>
                    <li><a href="/accounts/register">Register</a></li>

                </ul>
            </div>
        </div>

        <nav>
            <div class="container">
                <div class="nav-wrapper">
                    <div class="primary-nav">
                        <a href="/build" class="nav-build"><span>Do a</span> System Build</a>
                        <a href="/buildGuides.html" class="nav-guides"><span>View the</span> Build Guides</a>
                        <a href="/buildGuides.html" class="nav-builds"><span>See all</span> Completed Builds</a>
                        <a id="browse-parts-button" href="partList.html" class="nav-parts">
                            <span>Browse by</span>
                            Individual Parts
                        </a>
                    </div>

                    <div class="secondary-nav">
                        <div class="sub-links">
                            <a href="/products/pricedrop">Price Drops</a><a href="/trends">Price Trends</a><a href="/forums">Forums</a><a
                                href="/blog">Blog</a>
                        </div>
                        <div class="search"><a href="/search" class="search-parts"></a></div>
                    </div>
                </div>
            </div>
        </nav>
    </header>


    <div>
        <div class="system-build user">
            <div class="hero tabnav-hero">
                <div class="container">
                    <h1 class="title" id="choose-title">

                    </h1>
                </div>
            </div>

            <!--Body-->

            <div class="details">
                <div class="part-index-body">
                    <div class="container">
                        <div class="column-wrapper">
                            <div class="left-column">
                                <div id="filter">
                                    <h1>Filter</h1>
                                    <div>
                                        <h4>Price Range</h4>
                                        <label for="minprice">Min: </label><input type="number" id="minprice" name="minprice"
                                            value="0" min="0" max="1000000000" step="50000">
                                        <br />
                                        <label for="maxprice">Max: </label><input type="number" id="maxprice" name="maxprice"
                                            value="1000000000" min="0" max="1000000000" step="50000">
                                        <br/>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="right-column">
                                <div class="search-bar">
                                    Search CPUs: <input type="text" id="part_category_search" class="inactive_search">
                                </div>
                                <h2>Danh sách linh kiện</h2>

                                <div class="part-category-compat-compare">

                                </div>

                                <div>

                                    <table id="list_table" class="part-table tablesorter tablesorter-default" role="grid">
                                        <thead>
                                            <tr class="tablesorter-headerRow">
                                                <th>
                                                    <div>
                                                        Part Name
                                                    </div>
                                                    <div class='sort-symbol'>
                                                        <a href="#" onclick="sortBy('name', 'asc')">&uarr;</a>
                                                        <a href="#" onclick="sortBy('name', 'desc')">&darr;</a>
                                                    </div>
                                                </th>
                                                <th>
                                                    <div>
                                                        Lowest Price
                                                    </div>
                                                    <div class='sort-symbol'>
                                                        <a href="#" onclick="sortBy('price', 'asc')">&uarr;</a>
                                                        <a href="#" onclick="sortBy('price', 'desc')">&darr;</a>
                                                    </div>
                                                </th>
                                                <th></th>
                                                <th class="hidden"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="category_content" aria-live="polite" aria-relevant="all">
                                        </tbody>
                                    </table>

                                    <div id="page_button_row_bot"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="drop">
                <div id="search-tray-container">
                    <div class="container">
                        <div class="search-tray search-box">
                            <form action="/search/" method="get">
                                <input type="hidden" name="cc" value="us" />
                                <input id="search_q" type="text" name="q" size="32" autocomplete="off" />
                                <input id="search_go" type="submit" value="Search" />
                            </form>
                            <div id="search_result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!--footer-->
            <footer class="modal-footer">
                <div class="container">
                    <div class="footer-branding">
                        <div class="copyright-notice">&copy;2018 PCPartPicker, LLC. All rights reserved.</div>
                    </div>
                    <ul class="footer-nav">
                        <h4>Sections</h4>
                        <li><a href="/list/">System Builds</a></li>
                        <li><a href="/guide/">Build Guides</a></li>
                        <li><a href="/builds/">Completed Builds</a></li>
                        <li><a href="/products/">Individual Parts</a></li>
                    </ul>
                    <ul class="footer-nav">
                        <h4>PCPP</h4>
                        <li><a href="/forums/">Forums</a></li>
                        <li><a href="/products/pricedrop/">Price Drops</a></li>
                        <li><a href="/trends/">Price Trends</a></li>
                        <li><a href="/blog/">PCPP Blog</a></li>
                    </ul>
                    <ul class="footer-nav">
                        <h4>PCPP</h4>
                        <li><a href="/about/">About</a></li>
                        <li><a href="/contact/">Contact &amp; Imprint</a></li>
                        <li><a href="/tos/">Terms of Service</a></li>
                        <li><a href="/code-of-conduct/">User Code of Conduct</a></li>
                        <li><a href="/code-of-conduct/industry-affiliate/">Industry Code of Conduct</a></li>
                        <li><a href="/privacy/">Privacy Policy</a></li>
                        <li><a href="/disclosure/">Disclosure</a></li>
                    </ul>
                    <ul class="footer-nav">
                        <h4>Elsewhere</h4>
                        <li><a href="https://discord.gg/pcpartpicker">Discord</a></li>
                        <li><a href="https://www.facebook.com/pcpartpicker">Facebook</a></li>
                        <li><a href="https://instagram.com/pcpartpicker">Instagram</a></li>
                        <li><a href="https://twitch.tv/pcpartpicker">Twitch</a></li>
                        <li><a href="https://twitter.com/pcpartpicker">Twitter</a></li>
                        <li><a href="https://www.youtube.com/user/pcpartpicker">YouTube</a></li>
                    </ul>
                </div>
                <!-- <div class="container">
          <div class="pcpp-network">
            <h4>PCPP Network</h4>
            <div class="title-divider"></div>
            <ul>
              <li><a href="http://pcpartpicker.com" id="pcpp"></a></li>
            </ul>
          </div>
        </div> -->

            </footer>
            <div id="default_dialog" class="hidden-dialog"></div>

            <script src='/js/custom/build.js'></script>
            <script src='/js/custom/utility.js'></script>

            <script>
                let partType = window.location.pathname.split('/').pop();
                window.onload = async function () {
                    $('input[type=number]').on('keypress', filterByRange);
                    $('input#part_category_search').on('keypress', e => {
                        if (e.keyCode == 13) {
                            filterBy('name', e.target.value);
                        }
                    });
     
                    let partList = await getJson(`api/products/${partType}`);
                    renderTable(partType, partList);
                    renderFilter(partList, 'manufacturer');
                }

                function renderTable(partType, list) {
                    let tbody = document.querySelector('#category_content');
                    tbody.innerHTML = "";
                    for (part of list) {
                        let images = JSON.stringify(part.images ? part.images.split(',') : []);
                        let row = document.createElement('tr');
                        row.innerHTML = `<td class='tdname'><a href='/products/${partType}/${part.id}'>${part.name}</a></td>` +
                            `<td>${part.price.toLocaleString('vi-VN', { currency: 'VND', style: 'currency' })}</td>` +
                            `<td class='viewadd'><a href='/build' class='btn btn-primary' onclick='addPart(this)'>Thêm</a></td>` +
                            `<td class='hidden'>${part.price}</td>` +
                            `<td class='hidden'>${images}</td>` +
                            `<td class='hidden'>${part.merchant}</td>` + 
                            `<td class='hidden'>${part.url}</td>`;
                        tbody.appendChild(row);
                    }
                }

                async function renderFilter(partType, property) {
                    let list = await getJson(`api/filter/${partType}/${property}`)
                    let rootFilter = document.getElementById('filter');
                    let divFilter = document.createElement('div');

                    divFilter.id = `filter-${property}`;
                    divFilter.innerHTML = `<h4>${property}</h4>`;
                    for (value of list) {
                        let radioButton = `<input onclick="filterBy('${property}','${value}')" type='radio' name='${property}' value='${value}'/>${value}<br/>`;
                        divFilter.innerHTML += radioButton;
                    }

                    rootFilter.appendChild(divFilter);
                }
            </script>

            <script>
                function addPart(button) {
                    let currentBuild = new Build('currentBuild');
                    let row = button.parentElement.parentElement;
                    let link = row.querySelector('.tdname>a');

                    let id = link.getAttribute('href').split('/').pop();
                    let name = link.innerText;
                    let price = parseInt(row.cells[3].innerText);
                    let images = JSON.parse(row.cells[4].innerText);
                    let merchant = row.cells[5].innerText;
                    let url = row.cells[6].innerText;

                    currentBuild.add(partType, {
                        id: id,
                        name: name,
                        price: price,
                        merchant: merchant,
                        url: url,
                        images: images
                    });
                }

                async function filterByRange(e) {
                    if (e.keyCode == 13) {
                        let minPrice = document.getElementById('minprice').value;
                        let maxPrice = document.getElementById('maxprice').value;
                        await filterBy('priceRange', `${minPrice},${maxPrice}`);
                    }
                }

                async function filterBy(property, value) {
                    let partList = await getJson(`api/products/${partType}?property=${property}&value=${value}&sortBy=price`);
                    renderTable(partType, partList);
                }

                async function sortBy(property, direction = 'asc') {
                    let partList = await getJson(`api/products/${partType}?sortBy=${property}&direction=${direction}`);
                    renderTable(partType, partList);
                }
            </script>

            <!-- Optional JavaScript -->
            <!-- jQuery first, then Popper.js, then Bootstrap JS -->
            <script src="/js/custom/app.js"></script>
            <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
                crossorigin="anonymous"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
                crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
                crossorigin="anonymous"></script>
</body>

</html>